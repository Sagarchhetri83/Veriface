(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4902:function(){},522:function(){},753:function(){},8730:function(){},8551:function(e,t,r){Promise.resolve().then(r.bind(r,7259))},7259:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var a=r(7437),n=r(2265),s=r(273),i=r(4482);let o="".concat("/veriface","/models"),c=()=>{let[e,t]=(0,n.useState)({isLoading:!0,isActive:!1,error:null}),[r,a]=(0,n.useState)(null),[c,l]=(0,n.useState)([]),[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),f=(0,n.useRef)(null),g=(0,n.useRef)(null),x=(0,n.useRef)(null),p=(0,n.useRef)(null),y=async()=>{try{t(e=>({...e,isLoading:!0,error:null})),await Promise.all([s.qB.tinyFaceDetector.loadFromUri(o),s.qB.faceLandmark68Net.loadFromUri(o),s.qB.faceRecognitionNet.loadFromUri(o),s.qB.faceExpressionNet.loadFromUri(o),s.qB.ssdMobilenetv1.loadFromUri(o)]),console.log("Face-api models loaded successfully"),h(!0);let e=await (0,i.AW)();l(e),t(e=>({...e,isLoading:!1}))}catch(e){console.error("Error loading models:",e),t(e=>({...e,isLoading:!1,error:"Failed to load face recognition models"}))}},w=async()=>{try{if(!f.current)return;let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"},audio:!1});f.current.srcObject=e,x.current=e,t(e=>({...e,isActive:!0,error:null}))}catch(e){console.error("Error accessing webcam:",e),t(e=>({...e,isActive:!1,error:"Failed to access webcam. Please check permissions."}))}},b=(0,n.useCallback)(()=>{x.current&&(x.current.getTracks().forEach(e=>e.stop()),x.current=null),f.current&&(f.current.srcObject=null),p.current&&(clearInterval(p.current),p.current=null),t(e=>({...e,isActive:!1})),a(null)},[]),v=e=>{let t=null,r=1/0;for(let a of c){if(!a.descriptor)continue;let n=s.WI(e,a.descriptor);n<r&&n<.5&&(r=n,t=a)}let a=t?1-r:0;return{user:t,confidence:a,isKnown:null!==t,descriptor:e}},N=async()=>{if(f.current&&g.current&&!d){u(!0);try{let t=await s.Qr(f.current,new s.aK).withFaceLandmarks().withFaceDescriptors().withFaceExpressions(),r=g.current,n={width:f.current.videoWidth,height:f.current.videoHeight};s.JF(r,n);let i=r.getContext("2d");if(i&&i.clearRect(0,0,r.width,r.height),t.length>0){let o=s._C(t,n);s.ii.drawDetections(r,o),s.ii.drawFaceLandmarks(r,o);let c=t[0],l=c.descriptor,d=v(l);if(a(d),i){var e;let t=c.detection.box,r=d.isKnown?"".concat(null===(e=d.user)||void 0===e?void 0:e.name," (").concat(Math.round(100*d.confidence),"%)"):"Unknown Person";i.font="16px Arial",i.fillStyle=d.isKnown?"#00ff00":"#ff0000",i.fillText(r,t.x,t.y-5)}}else a(null)}catch(e){console.error("Error during face detection:",e)}finally{u(!1)}}},j=()=>{p.current&&clearInterval(p.current),p.current=setInterval(()=>{N()},500)},k=async e=>{if(!f.current)return null;try{let t=await s.bd(f.current,new s.aK).withFaceLandmarks().withFaceDescriptor();if(!t)throw Error("No face detected");let r={id:"user_".concat(Date.now()),name:e,descriptor:t.descriptor};return l(e=>[...e,r]),r}catch(e){return console.error("Error registering face:",e),null}};return(0,n.useEffect)(()=>(y(),()=>{b()}),[]),(0,n.useEffect)(()=>{if(e.isActive&&m&&f.current){let e=f.current;e.onloadedmetadata=()=>{j()},e.readyState>=3&&j()}},[e.isActive,m]),{videoRef:f,canvasRef:g,webcamStatus:e,detectedFace:r,knownUsers:c,isProcessing:d,startWebcam:w,stopWebcam:b,registerFace:k,capturePhoto:()=>{if(!f.current||!g.current)return null;let e=document.createElement("canvas");e.width=f.current.videoWidth,e.height=f.current.videoHeight;let t=e.getContext("2d");return t?(t.drawImage(f.current,0,0),e.toDataURL("image/jpeg")):null},detectFace:N}};var l=r(1011);function d(){var e;let{videoRef:t,canvasRef:r,webcamStatus:s,detectedFace:o,isProcessing:d,startWebcam:u,stopWebcam:m,registerFace:h,capturePhoto:f}=c(),[g,x]=(0,n.useState)(!1),[p,y]=(0,n.useState)(""),[w,b]=(0,n.useState)(null),[v,N]=(0,n.useState)(null),[j,k]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(null==o?void 0:o.isKnown)&&o.user&&o.confidence>.7&&v!==o.user.id&&E(o.user)},[o]);let F=async()=>{await u(),k(!0),b({type:"info",text:"Webcam started. Position your face in front of the camera."})},E=async e=>{try{let t=f(),r=new Date;await (0,i.YF)({userId:e.id,userName:e.name,timestamp:r,confidence:(null==o?void 0:o.confidence)||0,photoUrl:t||void 0,status:(0,l.zK)(r),location:"Main Office"}),N(e.id),b({type:"success",text:"Attendance marked for ".concat(e.name," at ").concat(r.toLocaleTimeString())}),setTimeout(()=>{N(null)},5e3)}catch(e){console.error("Error marking attendance:",e),b({type:"error",text:"Failed to mark attendance. Please try again."})}},D=async()=>{if(!p.trim()){b({type:"error",text:"Please enter a name"});return}x(!0);try{let e=await h(p);e&&e.descriptor?(await (0,i.JR)({...e,id:(0,l.zt)(),createdAt:new Date}),b({type:"success",text:"Successfully registered ".concat(p)}),y("")):b({type:"error",text:"No face detected. Please ensure your face is clearly visible."})}catch(e){console.error("Error registering user:",e),b({type:"error",text:"Failed to register user. Please try again."})}finally{x(!1)}};return(0,a.jsx)("div",{className:"max-w-6xl mx-auto p-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-6",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-white",children:"Face Recognition System"}),(0,a.jsx)("p",{className:"text-white/80 mt-2",children:"Automated attendance tracking with facial recognition"})]}),(0,a.jsxs)("div",{className:"p-6",children:[w&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-lg ".concat("success"===w.type?"bg-green-100 text-green-800 border border-green-200":"error"===w.type?"bg-red-100 text-red-800 border border-red-200":"bg-blue-100 text-blue-800 border border-blue-200"),children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"text-sm font-medium",children:w.text})})}),(0,a.jsx)("div",{className:"mb-6 flex flex-wrap gap-4",children:j?(0,a.jsx)("button",{onClick:()=>{m(),k(!1),b(null)},className:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl",children:"Stop Webcam"}):(0,a.jsx)("button",{onClick:F,disabled:s.isLoading,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:s.isLoading?"Loading Models...":"Start Webcam"})}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"bg-gray-100 rounded-xl overflow-hidden shadow-inner",children:(0,a.jsxs)("div",{className:"relative aspect-video bg-gray-900",children:[(0,a.jsx)("video",{ref:t,autoPlay:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),(0,a.jsx)("canvas",{ref:r,className:"absolute inset-0 w-full h-full"}),!j&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-gray-400",children:"Camera feed will appear here"})]})}),d&&(0,a.jsx)("div",{className:"absolute top-4 right-4",children:(0,a.jsx)("div",{className:"bg-yellow-500 text-white px-3 py-1 rounded-full text-xs font-medium animate-pulse",children:"Processing..."})})]})}),o&&j&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Detection Status"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,a.jsx)("span",{className:"font-medium ".concat(o.isKnown?"text-green-600":"text-orange-600"),children:o.isKnown?"Recognized":"Unknown Face"})]}),o.isKnown&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Name:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:null===(e=o.user)||void 0===e?void 0:e.name})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Confidence:"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:[Math.round(100*(o.confidence||0)),"%"]})]})]})]})]})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Register New User"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"Position your face clearly in the camera view and enter your name to register."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"userName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),(0,a.jsx)("input",{type:"text",id:"userName",value:p,onChange:e=>y(e.target.value),placeholder:"Enter your full name",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",disabled:!j||g})]}),(0,a.jsx)("button",{onClick:D,disabled:!j||g||!p.trim(),className:"w-full px-4 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Registering...":"Register Face"})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,a.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"Quick Tips:"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsx)("li",{children:"• Ensure good lighting on your face"}),(0,a.jsx)("li",{children:"• Look directly at the camera"}),(0,a.jsx)("li",{children:"• Remove glasses if possible"}),(0,a.jsx)("li",{children:"• Keep a neutral expression"})]})]})]})})]})]})]})})}},4482:function(e,t,r){"use strict";r.d(t,{AW:function(){return u},JR:function(){return d},YF:function(){return o},mU:function(){return l},zI:function(){return c}});var a=r(8199);r(4715),r(3884),r(6869),a.Z.apps.length||a.Z.initializeApp({apiKey:"AIzaSyBs1cXvJJ6RWZFJ7zuWpqumqkaalBNaVD8",authDomain:"veriface-attendance.firebaseapp.com",projectId:"veriface-attendance",storageBucket:"veriface-attendance.firebasestorage.app",messagingSenderId:"468894802308",appId:"1:468894802308:web:1f1ef817cc3923e0823dd1"});let n=a.Z.firestore();a.Z.auth(),a.Z.storage();let s="attendance",i="users",o=async e=>{try{let t=new Date;t.setHours(0,0,0,0);let r=n.collection(s).where("userId","==",e.userId).where("timestamp",">=",a.Z.firestore.Timestamp.fromDate(t)).limit(1),i=await r.get();if(!i.empty)return console.log("Attendance already marked for today"),i.docs[0].id;let o=await n.collection(s).add({...e,timestamp:a.Z.firestore.Timestamp.fromDate(e.timestamp)});return console.log("Attendance marked with ID:",o.id),o.id}catch(e){throw console.error("Error marking attendance:",e),e}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;try{let t=n.collection(s).orderBy("timestamp","desc").limit(e),r=await t.get(),a=[];return r.forEach(e=>{let t=e.data();a.push({id:e.id,userId:t.userId,userName:t.userName,timestamp:t.timestamp.toDate(),confidence:t.confidence,photoUrl:t.photoUrl,status:t.status||"present",location:t.location})}),a}catch(e){throw console.error("Error fetching attendance records:",e),e}},l=async()=>{try{let e=new Date;e.setHours(0,0,0,0);let t=n.collection(s).where("timestamp",">=",a.Z.firestore.Timestamp.fromDate(e)).orderBy("timestamp","desc"),r=await t.get(),i=[];return r.forEach(e=>{let t=e.data();i.push({id:e.id,userId:t.userId,userName:t.userName,timestamp:t.timestamp.toDate(),confidence:t.confidence,photoUrl:t.photoUrl,status:t.status||"present",location:t.location})}),i}catch(e){throw console.error("Error fetching today's attendance:",e),e}},d=async e=>{try{let t=n.collection(i).doc(e.id);await t.set({...e,descriptor:e.descriptor?Array.from(e.descriptor):null,createdAt:a.Z.firestore.FieldValue.serverTimestamp()}),console.log("User saved successfully")}catch(e){throw console.error("Error saving user:",e),e}},u=async()=>{try{let e=await n.collection(i).get(),t=[];return e.forEach(e=>{var r;let a=e.data();t.push({id:e.id,name:a.name,email:a.email,descriptor:a.descriptor?new Float32Array(a.descriptor):void 0,photoUrl:a.photoUrl,role:a.role,createdAt:null===(r=a.createdAt)||void 0===r?void 0:r.toDate()})}),t}catch(e){return console.error("Error fetching users:",e),[]}}},1011:function(e,t,r){"use strict";function a(e){return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}function n(e){return new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}function s(e){let t=e.getHours(),r=e.getMinutes();return t<9||9===t&&r<=15?"present":t<10?"late":"absent"}function i(){return"user_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}r.d(t,{mr:function(){return n},p6:function(){return a},zK:function(){return s},zt:function(){return i}})}},function(e){e.O(0,[358,349,711,573,278,971,938,744],function(){return e(e.s=8551)}),_N_E=e.O()}]);